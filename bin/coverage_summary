#!/bin/bash
set -e

COVERAGE_DIR=${COVERAGE_DIR:-/workspace/coverage_data}
COVERAGE_FILE=${COVERAGE_DIR}/.coverage

echo "ğŸ“Š RESUMEN DE COVERAGE"
echo "======================"

if [ ! -f "${COVERAGE_FILE}" ]; then
    echo "âŒ No se encontrÃ³ archivo .coverage"
    exit 1
fi

echo ""
echo "ğŸ“ˆ Coverage General:"
COVERAGE_FILE=${COVERAGE_FILE} coverage report | tail -1

echo ""
echo "ğŸ“‹ Archivos por Coverage:"
COVERAGE_FILE=${COVERAGE_FILE} coverage report --format=html | grep -E "(100%| [0-9]{1,3}%)"

echo ""
echo "ğŸ” Archivos < 80% (CRÃTICOS):"
COVERAGE_FILE=${COVERAGE_FILE} coverage report | grep -E "[0-7][0-9]%" || echo "âœ… Todos > 80%"

echo ""
echo "ğŸ“ Reportes generados:"
ls -la ${COVERAGE_DIR}/ | grep -E "(coverage.xml|htmlcov)"
