#!/bin/bash
set -e

echo "Esperando PostgreSQL en ${PGHOST:-postgres}:5432..."

# Timeout de 60 segundos
MAX_WAIT=60
COUNTER=0

until pg_isready -h ${PGHOST:-postgres} -p ${PGPORT:-5432} -U ${PGUSER:-odoo} -d postgres -q; do
  if [ $COUNTER -ge $MAX_WAIT ]; then
    echo "❌ Timeout: PostgreSQL no disponible después de ${MAX_WAIT}s"
    exit 1
  fi
  echo "PostgreSQL no está listo - esperando (${COUNTER}s)..."
  sleep 2
  ((COUNTER++))
done

echo "✅ PostgreSQL listo!"
